# 关于缓存一致性的问题及处理方案

# Mysql和缓存数据一致性问题

场景：在高并发并且使用缓存的情况下，很容易遇到的问题就是在进行更新商品库存时，该如何操作才能保证 mysql 和 缓存中的商品库存是一致的？

对于这样的问题一般有如下几种解决方案，有推荐大家使用的，也有不推荐大家使用的

不推荐的方案：

1. 先更新 MySQL，再更新缓存

在高并发情况下，假设此时商品库存为 10；A用户和B用户同时购买了一件该商品，请求 A、B 都是先更新 MySQL 然后再更新缓存，假设 A 在 B 之前，A 将库存更新为9，B 将库存更新为8，

这是如果请求 A 在更新缓存（Redis 连接）时卡了一会，请求 B 已经依次完成数据的更新并将缓存中的库存更新为 8，最后 A 请求更新了缓存中的库存，并将缓存中的库存更新为 9. 所以这时 mysql 和 缓存中的库存数据就是不一致的。

当用户 C 查看商品库存的时候就会发现库存是 9 而不是 8.

2. 先更新缓存，再更新 MySQL

问题同上



